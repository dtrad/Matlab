% Final Project 420.
close all

% Noisy data
d02=[6.74232696778393 7.49475788741694 9.22230118226824  9.15686986731049...
   9.70813320602581   8.75410856873526   8.69048947220669   8.07889735757564...
   7.38310538194028   5.89100631189977   5.35369700062469 ...
      5.03281425384827];

% Clean data
d0=[7.20420502907849 8.07524990707026   8.72763555955706   9.11597933755871...
   9.24392582501575   9.11638786465659   8.72264302646742   8.07247151726117...
   7.22837330362646   6.29032631827032   5.35686697074592 ...
     4.49947099832840];

% model
m=[0,0,0,0,0,.5,.8,1,.5,.3,.8,1.,.6,.3,.2,.1,.0,.0,.0,.0,.0]; 

M=12;
N=21;
m=m(:);
d0=d0(:);
d02=d02(:);
sigma2=(std(d0-d02))^2
sigma2=.15;
CdI=1/sigma2*eye(M);
%CdI=diag(1/((d0-d02).*(d0-d02)));
F=forwgrav2(5,N,M,1,1);
iter=0;
etav=logspace(-1,1,10);
for i=1:1:10
  eta=etav(i);
  iter=iter+1;
  figure
  m1=inv(F'*F+eta*eye(N))*F'*d02;
  Jd(iter)=(d02-F*m1)'*CdI*(d02-F*m1);
  Jm(iter)=m1'*m1;
  subplot(211),plot(1:12,d02,'*',1:12,F*m1,'o');
  subplot(223),bar(m);subplot(224),bar(m1);
end,
figure,
%subplot(211);loglog(Jd,Jm,'*')
subplot(311);loglog(Jd,Jm,'o');
subplot(312);semilogx(etav,Jd,'o');
subplot(313);semilogx(etav,Jm,'o');



